(()=>{"use strict";window.addEventListener("online",(()=>{navigator.serviceWorker.controller&&(navigator.connection&&navigator.connection.saveData&&navigator.serviceWorker.controller.postMessage({type:"FETCH_FROM_CACHE_FIRST"}),navigator.serviceWorker.controller.postMessage({type:"FETCH_FROM_NETWORK_FIRST"}))})),window.addEventListener("offline",(function(){navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"FETCH_FROM_CACHE_FIRST"})})),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw/sw.js").then((e=>{console.log("sw registered")})).catch((e=>{console.error("sw failed",e)}));let e,t=0;function n(e,t){for(let n=0;n<e.length;n++){const o=e[n];n<e.length/2?(o.style.top="calc(30% - "+t/2+"px)",o.classList.add("defense")):(o.style.top="calc(70% - "+t/2+"px)",o.classList.add("attack")),o.style.left=`calc(${n%(e.length/2)*16.6+8.3}% - ${t/2}px)`}}const o=[];let i=0;function r(e,t,n,r,s){o[i++]={player:e,moveFromX:t,moveToY:s,moveToX:r,moveFromY:n},o.length=i}function s(){if(i<=0)return;const e=o[--i];e.player.style.left=100*e.moveFromX+"%",e.player.style.top=100*e.moveFromY+"%"}function l(){if(i>=o.length)return;const e=o[i++];e.player.style.left=100*e.moveToX+"%",e.player.style.top=100*e.moveToY+"%"}!function(){const c=document.createElement("div");c.classList.add("field");const d=[];for(let e=0;e<12;++e){const e=document.createElement("div");e.classList.add("player"),d.push(e),c.appendChild(e)}document.body.appendChild(c),e=c.getBoundingClientRect(),t=Math.round(Math.min(10*e.width/100,10*e.height/100));for(let e of d)e.style.width=t+"px",e.style.height=t+"px";n(d,t);const a={};for(let t of d)t.addEventListener("mousedown",(n=>{e=c.getBoundingClientRect(),n.preventDefault(),a[-1]={div:t,offsetx:n.offsetX,offsety:n.offsetY,originX:t.offsetLeft/e.width,originY:t.offsetTop/e.height}})),t.addEventListener("touchstart",(n=>{e=c.getBoundingClientRect(),n.preventDefault();const o=t.getBoundingClientRect();for(let i=0;i<n.changedTouches.length;++i){const r=n.changedTouches[i];if(a[r.identifier])continue;const s=r.pageX-o.left,l=r.pageY-o.top;a[r.identifier]={div:t,offsetx:s,offsety:l,originX:t.offsetLeft/e.width,originY:t.offsetTop/e.height}}}));c.addEventListener("mousemove",(t=>{if(!(-1 in a))return;const n=t.pageX-a[-1].offsetx-e.left+"px",o=t.pageY-a[-1].offsety-e.top+"px";a[-1].div.style.left=n,a[-1].div.style.top=o})),c.addEventListener("touchmove",(t=>{const n=c.getBoundingClientRect();for(let o=0;o<t.changedTouches.length;++o){const i=t.changedTouches[o],r=i.identifier,s=i.pageX-a[r].offsetx-n.left,l=i.pageY-a[r].offsety-n.top;a[r].div.style.left=s/e.width*100+"%",a[r].div.style.top=l/e.height*100+"%"}})),c.addEventListener("mouseup",(t=>{if(-1 in a){const t=a[-1];r(t.div,t.originX,t.originY,t.div.offsetLeft/e.width,t.div.offsetTop/e.height),delete a[-1]}})),c.addEventListener("touchend",(t=>{for(let n=0;n<t.changedTouches.length;++n){const o=a[t.changedTouches[n].identifier];r(o.div,o.originX,o.originY,o.div.offsetLeft/e.width,o.div.offsetTop/e.height),delete a[t.changedTouches[n].identifier]}})),document.querySelector("#toolbar-btn-reset").addEventListener("click",(e=>{n(d,t),o.length=0,i=0})),document.querySelector("#toolbar-btn-fullscreen").addEventListener("click",(e=>{document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen({navigationUI:"hide"}).then((()=>screen.orientation.lock("landscape-primary")))})),document.querySelector("#toolbar-btn-undo").addEventListener("click",(t=>{t.preventDefault(),e=c.getBoundingClientRect(),s()})),document.querySelector("#toolbar-btn-redo").addEventListener("click",(t=>{t.preventDefault(),e=c.getBoundingClientRect(),l()})),document.body.addEventListener("keydown",(e=>{"z"!=e.key||!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||(e.preventDefault(),s()),"y"!=e.key||!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||(e.preventDefault(),l())})),screen.orientation.addEventListener("change",(n=>{e=c.getBoundingClientRect(),t=Math.round(Math.min(10*e.width/100,10*e.height/100));for(let e of d)e.style.width=t+"px",e.style.height=t+"px"}))}()})();